# Apache Server Configuration
# Security settings for Azhar Ali Portfolio

# ============================================
# DISABLE DIRECTORY LISTING
# ============================================
# Prevent users from browsing directory contents
Options -Indexes

# ============================================
# DIRECTORY-SPECIFIC PROTECTION
# ============================================
# Additional protection for sensitive directories
<IfModule mod_autoindex.c>
    # Disable directory indexing globally
    IndexIgnore *
</IfModule>

# ============================================
# FILE ACCESS CONTROL
# ============================================
# Protect sensitive files from direct access
<FilesMatch "^(\.|README|LICENSE|package\.json|package-lock\.json|\.gitignore|HACKER-FEATURES-REPORT\.md)">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# ============================================
# COMPREHENSIVE SECURITY HEADERS
# ============================================
<IfModule mod_headers.c>
    # Content Security Policy (CSP) - Restricts resource loading
    Header always set Content-Security-Policy "\
        default-src 'self'; \
        script-src 'self' 'unsafe-inline' 'unsafe-eval' \
            https://cdn.jsdelivr.net \
            https://cdnjs.cloudflare.com \
            https://unpkg.com \
            https://browser.sentry-cdn.com \
            https://www.googletagmanager.com \
            https://www.google-analytics.com; \
        style-src 'self' 'unsafe-inline' \
            https://fonts.googleapis.com \
            https://cdnjs.cloudflare.com; \
        font-src 'self' \
            https://fonts.gstatic.com \
            https://cdnjs.cloudflare.com \
            data:; \
        img-src 'self' https: data: blob:; \
        connect-src 'self' \
            https://www.google-analytics.com \
            https://*.sentry.io; \
        frame-ancestors 'none'; \
        base-uri 'self'; \
        form-action 'self';"

    # X-Frame-Options: Prevent clickjacking
    Header always set X-Frame-Options "DENY"

    # X-Content-Type-Options: Prevent MIME sniffing
    Header always set X-Content-Type-Options "nosniff"

    # Referrer-Policy: Control referrer information
    Header always set Referrer-Policy "no-referrer"

    # Permissions-Policy: Disable unnecessary features
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()"

    # X-XSS-Protection: Enable XSS filter
    Header always set X-XSS-Protection "1; mode=block"

    # Cross-Origin Policies
    Header always set Cross-Origin-Opener-Policy "same-origin"
    Header always set Cross-Origin-Resource-Policy "same-origin"
    Header always set Cross-Origin-Embedder-Policy "require-corp"

    # Strict-Transport-Security (HSTS)
    # IMPORTANT: Only enable after HTTPS is working!
    # Uncomment the line below once SSL certificate is verified:
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Remove server signature
    Header unset Server
    Header unset X-Powered-By
</IfModule>

# ============================================
# RESTRICT ACCESS TO SPECIFIC DIRECTORIES
# ============================================
# Explicitly deny access to directory listings in key folders
<DirectoryMatch "^.*/\.(git|github|vscode)">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</DirectoryMatch>

# Block access to .env files
<FilesMatch "^\.env">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# ============================================
# FORCE HTTPS (uncomment when SSL is configured)
# ============================================
# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteCond %{HTTPS} off
#     RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </IfModule>

# ============================================
# PERFORMANCE OPTIMIZATION
# ============================================
# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Browser caching
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/html "access plus 0 seconds"
</IfModule>

# ============================================
# ERROR DOCUMENTS
# ============================================
# Custom error pages (uncomment and create pages as needed)
# ErrorDocument 403 /403.html
# ErrorDocument 404 /404.html
# ErrorDocument 500 /500.html

# ============================================
# DEFAULT DOCUMENT
# ============================================
DirectoryIndex index.html index.htm

# ============================================
# HOTLINK PROTECTION (optional)
# ============================================
# Prevent other sites from directly linking to your images
# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteCond %{HTTP_REFERER} !^$
#     RewriteCond %{HTTP_REFERER} !^https?://(www\.)?YOUR-DOMAIN\.com [NC]
#     RewriteRule \.(jpg|jpeg|png|gif|svg|webp)$ - [F,L]
# </IfModule>

# ============================================
# SECURITY NOTES
# ============================================
# This configuration:
# - Disables directory browsing for ALL directories
# - Protects sensitive files (.git, .env, config files)
# - Adds security headers (XSS, clickjacking protection)
# - Enables compression and caching for performance
# - Blocks access to hidden directories and files
#
# Verification:
# - Navigate to https://your-domain.com/js/ → Should return 403 Forbidden
# - Navigate to https://your-domain.com/assets/ → Should return 403 Forbidden
# - Navigate to https://your-domain.com/assets/styles/ → Should return 403 Forbidden
# - Files remain accessible: https://your-domain.com/js/main.js → Should load
